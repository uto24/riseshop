<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>টেলিগ্রাম প্রিমিয়াম কিনুন - রাইজশপ</title>
    <!-- Common Styles and Fonts (Copied) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary-glow: #00f5c3; --secondary-glow: #ff00e5; --bg-color: #0a0a14; --card-bg-color: rgba(16, 20, 42, 0.7); --text-color: #e0e0e0; --text-secondary-color: #a0a0b0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hind Siliguri', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.5; }
        .header { padding: 1.2rem 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(10, 10, 20, 0.7); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0, 245, 195, 0.2); }
        .logo { font-family: 'Poppins', sans-serif; font-size: 1.8rem; font-weight: 700; text-decoration: none; color: #fff; text-shadow: 0 0 5px var(--primary-glow); }
        .logo i { margin-right: 8px; }
        .btn { display: inline-block; padding: 0.6rem 1.8rem; border: 2px solid var(--primary-glow); border-radius: 50px; text-decoration: none; font-weight: 700; transition: all 0.4s ease; background: transparent; color: var(--primary-glow); font-size: 0.9rem; }
        .btn:hover { background: var(--primary-glow); color: var(--bg-color); }

        .buy-container { padding: 4rem 5%; max-width: 1400px; margin: 0 auto; }
        .page-title { text-align: center; font-size: 2.8rem; color: #fff; text-shadow: 0 0 10px var(--primary-glow); margin-bottom: 3rem; }
        
        .buy-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }
        
        .product-details, .purchase-form { background: var(--card-bg-color); padding: 2rem; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); }
        .card-title { font-size: 1.6rem; color: var(--primary-glow); margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(0, 245, 195, 0.3); }
        .card-title i { margin-right: 10px; }
        
        .features-list { list-style: none; padding-left: 0; }
        .features-list li { display: flex; align-items: flex-start; margin-bottom: 1rem; font-size: 1.1rem; }
        .features-list li i { color: var(--primary-glow); margin-right: 15px; margin-top: 5px; }

        .category-selection .card-title { margin-top: 2rem; }
        .category-grid { display: flex; flex-direction: column; gap: 1rem; }
        .category-grid input[type="radio"] { display: none; }
        .category-grid label { display: block; padding: 1rem 1.5rem; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; }
        .category-grid label:hover { background: rgba(0, 245, 195, 0.1); border-color: var(--primary-glow); }
        .category-grid input[type="radio"]:checked + label { background: rgba(0, 245, 195, 0.2); border-color: var(--primary-glow); box-shadow: 0 0 15px rgba(0, 245, 195, 0.3); }
        .category-grid .cat-name { display: block; font-size: 1.2rem; font-weight: 600; color: #fff; }
        .category-grid .cat-price { color: var(--primary-glow); font-family: 'Poppins', sans-serif; }
        .category-grid .cat-desc { font-size: 0.9rem; color: var(--text-secondary-color); }

        .form-group { margin-top: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary-color); }
        .form-group input { width: 100%; padding: 0.8rem; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: var(--text-color); font-size: 1rem; }

        .price-summary { margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem; }
        .price-line { display: flex; justify-content: space-between; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .price-line.total { font-size: 1.5rem; font-weight: 700; color: var(--primary-glow); }
        .price-line #discountAmount { color: #ff4d4d; }

        .coupon-group { display: flex; gap: 0.5rem; margin-top: 1rem; }
        #couponMessage { font-size: 0.9rem; margin-top: 0.5rem; height: 1em; }
        #couponMessage.success { color: var(--primary-glow); }
        #couponMessage.error { color: #ff4d4d; }

        .btn-submit { display: block; width: 100%; padding: 1rem; border: 2px solid var(--primary-glow); border-radius: 50px; font-weight: 700; transition: all 0.4s ease; background: var(--primary-glow); color: var(--bg-color); text-transform: uppercase; letter-spacing: 1px; cursor: pointer; font-size: 1.1rem; margin-top: 2rem; }
        .btn-submit:disabled { background: #555; border-color: #555; color: #999; cursor: not-allowed; }

        @media (max-width: 992px) {
            .buy-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>
    <header class="header">
        <a href="/" class="logo"><i class="fa-solid fa-rocket"></i> RiseShop</a>
        <a href="/login" id="headerAuthBtn" class="btn">লগইন</a>
    </header>

    <main class="buy-container">
        <h1 class="page-title">টেলিগ্রাম প্রিমিয়াম কিনুন</h1>
        <div class="buy-grid">
            
            <div class="product-details">
                <h2 class="card-title"><i class="fa-brands fa-telegram"></i>টেলিগ্রাম প্রিমিয়ামের সুবিধা</h2>
                <ul class="features-list">
                    <li><i class="fa-solid fa-check-circle"></i>৪ জিবি পর্যন্ত ফাইল আপলোডের সুবিধা।</li>
                    <li><i class="fa-solid fa-check-circle"></i>সর্বোচ্চ গতিতে ফাইল ডাউনলোড।</li>
                    <li><i class="fa-solid fa-check-circle"></i>কোনো ধরনের বিজ্ঞাপন ছাড়াই টেলিগ্রাম ব্যবহারের অভিজ্ঞতা।</li>
                    <li><i class="fa-solid fa-check-circle"></i>বিশেষ প্রিমিয়াম স্টিকার এবং রিঅ্যাকশন।</li>
                    <li><i class="fa-solid fa-check-circle"></i>প্রোফাইলে প্রিমিয়াম ব্যাজ এবং অ্যানিমেটেড প্রোফাইল ছবি।</li>
                    <li><i class="fa-solid fa-check-circle"></i> ভয়েস মেসেজকে টেক্সটে রূপান্তরের সুবিধা।</li>
                </ul>

                <h2 class="card-title" style="margin-top: 2rem;"><i class="fa-solid fa-truck-fast"></i>অ্যাক্টিভেশন প্রসেস</h2>
                <ul class="features-list">
                    <li><i class="fa-solid fa-mobile-screen-button"></i>আপনার দেওয়া টেলিগ্রাম নাম্বারে আমরা গিফট হিসেবে প্রিমিয়াম অ্যাক্টিভেট করে দেব।</li>
                    <li><i class="fa-solid fa-clock"></i>পেমেন্ট সম্পন্ন হওয়ার ৩০ মিনিটের মধ্যে আপনার সাবস্ক্রিপশন চালু হয়ে যাবে।</li>
                    <li><i class="fa-solid fa-shield-halved"></i>প্রসেসটি ১০০% নিরাপদ এবং আপনার অ্যাকাউন্টের কোনো অ্যাক্সেসের প্রয়োজন নেই।</li>
                </ul>
            </div>

            <div class="purchase-form">
                <form id="buyForm">
                    <h2 class="card-title"><i class="fa-solid fa-shopping-cart"></i>আপনার সাবস্ক্রিপশন</h2>
                    
                    <div class="category-selection">
                        <div class="category-grid">
                            <input type="radio" id="plan1" name="subscription_plan" value="700">
                            <label for="plan1">
                                <span class="cat-name">৩ মাসের প্ল্যান <span class="cat-price">৳৭০০</span></span>
                                <span class="cat-desc">স্বল্পমেয়াদী ব্যবহারের জন্য সেরা।</span>
                            </label>
                            
                            <input type="radio" id="plan2" name="subscription_plan" value="1300">
                            <label for="plan2">
                                <span class="cat-name">৬ মাসের প্ল্যান <span class="cat-price">৳১৩০০</span></span>
                                <span class="cat-desc">সাশ্রয়ী এবং জনপ্রিয় প্ল্যান।</span>
                            </label>

                            <input type="radio" id="plan3" name="subscription_plan" value="2400">
                            <label for="plan3">
                                <span class="cat-name">১ বছরের প্ল্যান <span class="cat-price">৳২৪০০</span></span>
                                <span class="cat-desc">এক বছরের জন্য নিশ্চিন্ত থাকুন।</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="telegramNumber">আপনার টেলিগ্রাম নাম্বার</label>
                        <input type="text" id="telegramNumber" placeholder="যেমন: +88017..." required>
                    </div>
                    
                    <div class="price-summary">
                        <div class="price-line">
                            <span>সাবটোটাল</span>
                            <span id="subtotalPrice">৳0</span>
                        </div>
                        <div class="price-line">
                            <span>ডিসকাউন্ট</span>
                            <span id="discountAmount">- ৳0</span>
                        </div>
                        <hr style="border-color: rgba(255,255,255,0.1); margin: 1rem 0;">
                        <div class="price-line total">
                            <span>মোট</span>
                            <span id="totalPrice">৳0</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="couponCode">কুপন কোড (যদি থাকে)</label>
                        <div class="coupon-group">
                            <input type="text" id="couponCode" placeholder="এখানে কুপন দিন">
                        </div>
                        <p id="couponMessage"></p>
                    </div>

                    <button type="submit" id="submitBtn" class="btn-submit" disabled>প্ল্যান সিলেক্ট করুন</button>
                </form>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const form = document.getElementById('buyForm');
            const planRadios = document.querySelectorAll('input[name="subscription_plan"]');
            const couponInput = document.getElementById('couponCode');
            const subtotalEl = document.getElementById('subtotalPrice');
            const discountEl = document.getElementById('discountAmount');
            const totalEl = document.getElementById('totalPrice');
            const couponMessageEl = document.getElementById('couponMessage');
            const submitBtn = document.getElementById('submitBtn');
            const telegramNumberInput = document.getElementById('telegramNumber');
            const headerAuthBtn = document.getElementById('headerAuthBtn');

            const validCoupons = ['652', '658'];
            let userDetails = null;

            // --- Helper Functions ---
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            // --- Check Login Status ---
            const userCookie = getCookie('userDetails');
            if (userCookie) {
                try {
                    userDetails = JSON.parse(decodeURIComponent(userCookie));
                    headerAuthBtn.href = '/profile';
                    headerAuthBtn.textContent = 'প্রোফাইল';
                } catch (e) { console.error("Cookie parsing error:", e); }
            } else {
                 headerAuthBtn.href = `/login?redirect=${encodeURIComponent(window.location.href)}`;
                 headerAuthBtn.textContent = 'লগইন';
            }

            // --- Main Calculation Function ---
            function updatePrice() {
                const selectedPlan = document.querySelector('input[name="subscription_plan"]:checked');
                
                if (!selectedPlan) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'প্ল্যান সিলেক্ট করুন';
                    return;
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'পেমেন্ট করুন';

                const subtotal = parseFloat(selectedPlan.value);
                
                let discount = 0;
                const couponCode = couponInput.value.trim();

                if (validCoupons.includes(couponCode) && subtotal > 50) {
                    discount = subtotal * 0.10;
                    couponMessageEl.textContent = 'কুপন সফলভাবে প্রয়োগ করা হয়েছে!';
                    couponMessageEl.className = 'success';
                } else if (couponCode && !validCoupons.includes(couponCode)) {
                    couponMessageEl.textContent = 'ভুল কুপন কোড।';
                    couponMessageEl.className = 'error';
                } else {
                    couponMessageEl.textContent = '';
                }

                const total = subtotal - discount;

                subtotalEl.textContent = `৳${subtotal.toFixed(2)}`;
                discountEl.textContent = `- ৳${discount.toFixed(2)}`;
                totalEl.textContent = `৳${total.toFixed(2)}`;
            }

            // --- Event Listeners ---
            planRadios.forEach(radio => radio.addEventListener('change', updatePrice));
            couponInput.addEventListener('input', updatePrice);

            // --- Form Submission ---
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                if (!userDetails) {
                    alert('এই অর্ডারটি সম্পন্ন করতে অনুগ্রহ করে আগে লগইন করুন।');
                    window.location.href = `/login?redirect=${encodeURIComponent(window.location.href)}`;
                    return;
                }

                const selectedPlanEl = document.querySelector('input[name="subscription_plan"]:checked');
                if (!selectedPlanEl) {
                    alert('অনুগ্রহ করে একটি সাবস্ক্রিপশন প্ল্যান সিলেক্ট করুন।');
                    return;
                }
                
                const telegramNumber = telegramNumberInput.value.trim();
                if (!telegramNumber) {
                    alert('অনুগ্রহ করে আপনার টেলিগ্রাম নাম্বার দিন।');
                    return;
                }

                const planLabel = document.querySelector(`label[for="${selectedPlanEl.id}"] .cat-name`).textContent;
                const totalText = totalEl.textContent;

                const orderDetails = {
                    productName: 'Telegram Premium',
                    category: planLabel,
                    quantity: 1, // Quantity is always 1 for subscriptions
                    telegramNumber: telegramNumber,
                    totalPrice: totalText,
                    deliveryEmail: userDetails.email, // Use registered email for confirmation
                    couponUsed: couponInput.value.trim(),
                    timestamp: new Date().toISOString()
                };

                const d = new Date();
                d.setTime(d.getTime() + (15 * 60 * 1000));
                let expires = "expires=" + d.toUTCString();
                document.cookie = `orderDetails=${JSON.stringify(orderDetails)};${expires};path=/`;

                alert('আপনার অর্ডারটি গ্রহণ করা হয়েছে। এখন পেমেন্ট পেজে নিয়ে যাওয়া হচ্ছে...');
                window.location.href = '/payment';
            });

            updatePrice();
            
            // Particle JS
            const canvas = document.getElementById('particle-canvas'); if (canvas) { const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particlesArray; class Particle { constructor(x, y, dX, dY, s, c) { this.x=x; this.y=y; this.directionX=dX; this.directionY=dY; this.size=s; this.color=c; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false); ctx.fillStyle = this.color; ctx.fill(); } update() { if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX; if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY; this.x += this.directionX; this.y += this.directionY; this.draw(); } } function init() { particlesArray = []; let num = (canvas.height * canvas.width) / 9000; for (let i = 0; i < num; i++) { let s = (Math.random() * 2) + 1, x = (Math.random() * ((innerWidth - s * 2) - (s * 2)) + s * 2), y = (Math.random() * ((innerHeight - s * 2) - (s * 2)) + s * 2), dX = (Math.random() * .4) - .2, dY = (Math.random() * .4) - .2, c = 'rgba(0, 245, 195, 0.5)'; particlesArray.push(new Particle(x, y, dX, dY, s, c)); } } function animate() { requestAnimationFrame(animate); ctx.clearRect(0, 0, innerWidth, innerHeight); for (let i = 0; i < particlesArray.length; i++) particlesArray[i].update(); } init(); animate(); window.addEventListener('resize', () => { canvas.width = innerWidth; canvas.height = innerHeight; init(); }); }
        });
    </script>
</body>
</html>
